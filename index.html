<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ðŸ§  Why You Can't Start</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        body {
            font-family: 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            background: #000;
            position: relative;
            cursor: pointer;
            -webkit-overflow-scrolling: touch;
        }

        /* Entry Screen Styles */
        .entry-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #000 0%, #1a0033 50%, #000 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            transition: opacity 2s ease-out;
        }

        .entry-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .diagnostic-orb {
            width: min(120px, 25vw);
            height: min(120px, 25vw);
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, 
                rgba(255, 255, 255, 0.8) 0%,
                rgba(138, 43, 226, 0.6) 30%,
                rgba(75, 0, 130, 0.4) 60%,
                rgba(25, 25, 112, 0.8) 100%);
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 
                0 0 50px rgba(138, 43, 226, 0.8),
                inset 0 0 30px rgba(255, 255, 255, 0.2);
            animation: orbPulse 3s ease-in-out infinite, orbFloat 4s ease-in-out infinite;
            cursor: pointer;
            position: relative;
            margin-bottom: 40px;
            touch-action: manipulation;
        }

        .diagnostic-orb::before {
            content: 'ðŸ§ ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: min(40px, 8vw);
            animation: sparkle 2s ease-in-out infinite alternate;
        }

        .diagnostic-orb::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60%;
            height: 60%;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: innerGlow 3s linear infinite;
        }

        @keyframes orbPulse {
            0%, 100% { 
                box-shadow: 
                    0 0 50px rgba(138, 43, 226, 0.8),
                    inset 0 0 30px rgba(255, 255, 255, 0.2);
            }
            50% { 
                box-shadow: 
                    0 0 80px rgba(138, 43, 226, 1),
                    0 0 120px rgba(255, 20, 147, 0.6),
                    inset 0 0 40px rgba(255, 255, 255, 0.4);
            }
        }

        @keyframes orbFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes sparkle {
            0% { opacity: 0.4; transform: translate(-50%, -50%) scale(0.8); }
            100% { opacity: 0.8; transform: translate(-50%, -50%) scale(1.2); }
        }

        @keyframes innerGlow {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .entry-text {
            color: #E6E6FA;
            text-align: center;
            font-size: clamp(18px, 5vw, 24px);
            text-shadow: 0 0 20px rgba(230, 230, 250, 0.5);
            margin-bottom: 20px;
            animation: textGlow 2s ease-in-out infinite alternate;
            padding: 0 20px;
        }

        .entry-subtitle {
            color: rgba(230, 230, 250, 0.7);
            text-align: center;
            font-size: clamp(14px, 3.5vw, 16px);
            font-style: italic;
            text-shadow: 0 0 10px rgba(230, 230, 250, 0.3);
            margin-bottom: 30px;
            animation: fadeInOut 3s ease-in-out infinite;
            padding: 0 20px;
        }

        .click-prompt {
            color: rgba(255, 255, 255, 0.8);
            font-size: clamp(12px, 3vw, 14px);
            text-align: center;
            animation: pulseText 2s ease-in-out infinite;
            margin-top: 20px;
            padding: 0 20px;
        }

        @keyframes textGlow {
            0% { text-shadow: 0 0 20px rgba(230, 230, 250, 0.5); }
            100% { text-shadow: 0 0 30px rgba(230, 230, 250, 0.8), 0 0 40px rgba(138, 43, 226, 0.3); }
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        @keyframes pulseText {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        /* Floating mystical particles for entry screen */
        .entry-particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: rgba(138, 43, 226, 0.6);
            border-radius: 50%;
            animation: entryFloat 8s linear infinite;
            box-shadow: 0 0 6px rgba(138, 43, 226, 0.8);
        }

        @keyframes entryFloat {
            0% { 
                transform: translateY(100vh) translateX(0) scale(0);
                opacity: 0;
            }
            10% { 
                opacity: 1;
                transform: translateY(90vh) translateX(10px) scale(1);
            }
            90% { 
                opacity: 1;
                transform: translateY(10vh) translateX(-10px) scale(1);
            }
            100% { 
                transform: translateY(-10vh) translateX(20px) scale(0);
                opacity: 0;
            }
        }

        /* Intro Scene Styles */
        .intro-scene {
            opacity: 0;
            pointer-events: none;
            transition: opacity 2s ease-in;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1500;
        }

        .intro-scene.active {
            opacity: 1;
            pointer-events: auto;
        }

        .intro-scene.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        /* Main flowchart styles */
        .main-scene {
            opacity: 0;
            pointer-events: none;
            transition: opacity 2s ease-in;
            overflow-y: auto;
            height: 100vh;
            -webkit-overflow-scrolling: touch;
        }

        .main-scene.active {
            opacity: 1;
            pointer-events: auto;
        }

        /* Cosmic Background */
        .cosmic-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, 
                rgba(75, 0, 130, 0.3) 0%, 
                rgba(25, 25, 112, 0.2) 35%, 
                rgba(0, 0, 0, 0.9) 70%,
                #000 100%);
            animation: cosmicShift 20s ease-in-out infinite alternate;
        }

        @keyframes cosmicShift {
            0% { 
                background: radial-gradient(ellipse at center, 
                    rgba(75, 0, 130, 0.3) 0%, 
                    rgba(25, 25, 112, 0.2) 35%, 
                    rgba(0, 0, 0, 0.9) 70%,
                    #000 100%);
            }
            50% {
                background: radial-gradient(ellipse at center, 
                    rgba(147, 0, 211, 0.2) 0%, 
                    rgba(72, 61, 139, 0.3) 35%, 
                    rgba(25, 25, 112, 0.1) 70%,
                    #000 100%);
            }
            100% { 
                background: radial-gradient(ellipse at center, 
                    rgba(199, 21, 133, 0.2) 0%, 
                    rgba(138, 43, 226, 0.1) 35%, 
                    rgba(0, 0, 0, 0.9) 70%,
                    #000 100%);
            }
        }

        /* Starfield */
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0;
            animation: twinkle 3s ease-in-out infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0; transform: scale(1); }
            25% { opacity: 0.3; }
            50% { opacity: 1; transform: scale(1.2); }
            75% { opacity: 0.7; }
        }

        /* Moving Chatbox Container */
        .moving-chatbox {
            position: fixed;
            width: 95%;
            max-width: 600px;
            z-index: 100;
            opacity: 0;
            transition: all 1.5s ease-in-out;
            pointer-events: none;
        }

        .moving-chatbox.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .moving-chatbox.fade-out {
            opacity: 0;
            transform: translateY(30px);
        }

        /* Position variations for the moving chatbox - Mobile Optimized */
        .position-bottom-center {
            bottom: 10%;
            left: 50%;
            transform: translateX(-50%);
        }

        .position-top-right {
            top: 10%;
            right: 2.5%;
            transform: translateX(0);
        }

        .position-middle-left {
            top: 35%;
            left: 2.5%;
            transform: translateY(-50%);
        }

        .position-bottom-left {
            bottom: 15%;
            left: 2.5%;
            transform: translateX(0);
        }

        .position-top-center {
            top: 15%;
            left: 50%;
            transform: translateX(-50%);
        }

        .position-middle-right {
            top: 45%;
            right: 2.5%;
            transform: translateY(-50%);
        }

        /* Game-style Chatbox */
        .chatbox {
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid #8A2BE2;
            border-radius: 15px;
            padding: clamp(15px, 4vw, 25px);
            box-shadow: 
                0 0 20px rgba(138, 43, 226, 0.5),
                inset 0 0 20px rgba(138, 43, 226, 0.1);
            position: relative;
            animation: shimmer 4s ease-in-out infinite;
            backdrop-filter: blur(10px);
        }

        @keyframes shimmer {
            0%, 100% { 
                border-color: #8A2BE2;
                box-shadow: 0 0 20px rgba(138, 43, 226, 0.5), inset 0 0 20px rgba(138, 43, 226, 0.1);
            }
            50% { 
                border-color: #FF1493;
                box-shadow: 0 0 30px rgba(255, 20, 147, 0.6), inset 0 0 25px rgba(255, 20, 147, 0.1);
            }
        }

        .narrator-label {
            color: #FF1493;
            font-size: clamp(10px, 2.5vw, 12px);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(255, 20, 147, 0.5);
        }

        .dialogue-text {
            color: #E6E6FA;
            font-size: clamp(14px, 3.5vw, 16px);
            line-height: 1.6;
            min-height: 40px;
            text-shadow: 0 0 10px rgba(230, 230, 250, 0.3);
        }

        .typing-cursor {
            display: inline-block;
            width: 2px;
            height: clamp(16px, 4vw, 18px);
            background: #FF1493;
            margin-left: 2px;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        /* Flowchart Styles - Mobile Optimized */
        .container {
            max-width: 100%;
            margin: 0 auto;
            text-align: center;
            position: relative;
            z-index: 10;
            padding: 1rem;
        }

        h1 {
            font-size: clamp(24px, 6vw, 40px);
            margin-bottom: 1rem;
            color: #E6E6FA;
            text-shadow: 0 0 20px rgba(230, 230, 250, 0.5);
            font-family: 'Courier New', monospace;
        }

        .subtitle {
            font-size: clamp(14px, 3.5vw, 18px);
            margin-bottom: 2rem;
            color: rgba(230, 230, 250, 0.7);
            font-style: italic;
            text-shadow: 0 0 10px rgba(230, 230, 250, 0.3);
            padding: 0 1rem;
            line-height: 1.4;
        }

        .flowchart {
            position: relative;
            min-height: calc(100vh - 200px);
            padding: 1rem;
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .node {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid #8A2BE2;
            border-radius: 15px;
            padding: clamp(12px, 3vw, 16px);
            min-width: clamp(180px, 45vw, 250px);
            max-width: clamp(250px, 60vw, 320px);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.5);
            transform-origin: center;
            backdrop-filter: blur(10px);
            font-family: 'Courier New', monospace;
            touch-action: manipulation;
        }

        .node:hover, .node:active {
            transform: scale(1.02);
            box-shadow: 0 0 30px rgba(138, 43, 226, 0.8);
            border-color: #FF1493;
        }

        .node.active {
            border-color: #FF1493;
            box-shadow: 0 0 30px rgba(255, 20, 147, 0.6);
        }

        .node-text {
            font-size: clamp(13px, 3.2vw, 16px);
            line-height: 1.5;
            margin-bottom: 0.5rem;
            color: #E6E6FA;
            text-shadow: 0 0 10px rgba(230, 230, 250, 0.3);
        }

        .choices {
            display: none;
            margin-top: 1rem;
        }

        .choices.visible {
            display: block;
        }

        .choice-btn {
            background: linear-gradient(45deg, #8A2BE2, #FF1493);
            color: white;
            border: none;
            padding: clamp(10px, 2.5vw, 12px) clamp(14px, 3.5vw, 16px);
            margin: 0.25rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: clamp(12px, 3vw, 14px);
            font-family: 'Courier New', monospace;
            box-shadow: 0 2px 8px rgba(138, 43, 226, 0.3);
            touch-action: manipulation;
            width: 100%;
            text-align: center;
        }

        .choice-btn:hover, .choice-btn:active {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(138, 43, 226, 0.5);
        }

        .terminal-node {
            background: rgba(25, 25, 112, 0.4);
            border-color: #FFD700;
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.5);
        }

        .terminal-text {
            color: #FFD700;
            font-weight: bold;
            font-size: clamp(14px, 3.5vw, 17px);
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
            line-height: 1.5;
        }

        .connection {
            position: absolute;
            background: linear-gradient(90deg, #8A2BE2, #FF1493);
            height: 2px;
            transform-origin: left center;
            opacity: 0.6;
            z-index: -1;
            box-shadow: 0 0 5px rgba(138, 43, 226, 0.5);
        }

        .controls {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .btn {
            background: linear-gradient(45deg, #8A2BE2, #FF1493);
            color: white;
            border: none;
            padding: clamp(8px, 2vw, 12px) clamp(12px, 3vw, 16px);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: clamp(11px, 2.8vw, 14px);
            font-family: 'Courier New', monospace;
            box-shadow: 0 2px 8px rgba(138, 43, 226, 0.3);
            touch-action: manipulation;
            white-space: nowrap;
        }

        .btn:hover, .btn:active {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(138, 43, 226, 0.5);
        }

        .path-display {
            position: fixed;
            bottom: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #8A2BE2;
            padding: clamp(10px, 2.5vw, 16px);
            border-radius: 8px;
            font-size: clamp(11px, 2.8vw, 14px);
            color: #E6E6FA;
            text-shadow: 0 0 10px rgba(230, 230, 250, 0.3);
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.3);
            backdrop-filter: blur(10px);
            font-family: 'Courier New', monospace;
            max-height: 25vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* Music Toggle - Mobile Optimized */
        .music-toggle {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(138, 43, 226, 0.3);
            border: 2px solid #8A2BE2;
            border-radius: 50%;
            width: clamp(40px, 10vw, 50px);
            height: clamp(40px, 10vw, 50px);
            color: #E6E6FA;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(16px, 4vw, 20px);
            transition: all 0.3s ease;
            z-index: 200;
            font-family: 'Courier New', monospace;
            touch-action: manipulation;
        }

        .music-toggle:hover, .music-toggle:active {
            background: rgba(138, 43, 226, 0.5);
            transform: scale(1.05);
        }

        .music-toggle.playing {
            animation: musicPulse 2s ease-in-out infinite;
        }

        @keyframes musicPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .hidden {
            display: none;
        }

        @keyframes nodeAppear {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .node.new {
            animation: nodeAppear 0.5s ease;
        }

        /* Mobile-specific flowchart layout */
        @media (max-width: 768px) {
            .flowchart {
                padding: 0.5rem;
            }

            /* Adjust node positions for mobile - stack vertically more */
            .node {
                position: relative !important;
                margin: 1rem auto;
                display: block;
                left: auto !important;
                top: auto !important;
                width: 100%;
                max-width: 90vw;
            }

            /* Hide connections on mobile for cleaner look */
            .connection {
                display: none;
            }

            /* Adjust controls for mobile */
            .controls {
                position: static;
                flex-direction: row;
                justify-content: center;
                margin: 1rem auto;
                gap: 10px;
                flex-wrap: wrap;
            }

            .path-display {
                position: static;
                margin: 1rem auto;
                max-height: none;
            }
        }

        /* Very small screens */
        @media (max-width: 480px) {
            .moving-chatbox {
                width: 98%;
            }

            .chatbox {
                padding: 12px;
            }

            .dialogue-text {
                font-size: 13px;
            }

            .node {
                min-width: 85vw;
                max-width: 85vw;
            }

            .btn {
                padding: 6px 10px;
                font-size: 10px;
            }
        }

        /* Landscape mobile optimization */
        @media (max-width: 768px) and (orientation: landscape) {
            .entry-screen {
                flex-direction: row;
                gap: 2rem;
            }

            .diagnostic-orb {
                margin-bottom: 0;
            }

            .moving-chatbox {
                max-width: 70%;
            }

            .position-middle-left, .position-middle-right {
                top: 30%;
            }
        }
    </style>
</head>
<body>
    <!-- Entry Screen -->
    <div class="entry-screen" id="entryScreen">
        <div class="diagnostic-orb" id="diagnosticOrb"></div>
        <div>
            <div class="entry-text">ðŸ§  A Diagnostic Tool Awaits</div>
            <div class="entry-subtitle">For when your brain is cosplaying as a broken GPS...</div>
            <div class="click-prompt">âœ¨ Touch the orb to begin your journey âœ¨</div>
        </div>
    </div>

    <!-- Intro Scene -->
    <div class="intro-scene" id="introScene">
        <div class="cosmic-bg"></div>
        
        <!-- Moving chatbox that will be repositioned -->
        <div class="moving-chatbox position-bottom-center" id="movingChatbox">
            <div class="chatbox">
                <div class="narrator-label">THE GUIDE</div>
                <div class="dialogue-text" id="dialogue"></div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div class="main-scene" id="mainScene">
        <div class="cosmic-bg" id="mainCosmicBg"></div>
        
        <div class="container">
            <h1>Why You Can't Start</h1>
            <p class="subtitle">A darkly humorous diagnostic tool for when your brain is being a particularly unhelpful roommate</p>
            
            <div class="flowchart" id="flowchart">
                <!-- Nodes will be dynamically created here -->
            </div>

            <div class="controls">
                <button class="btn" onclick="startOver()">Start Over</button>
                <button class="btn" onclick="downloadPath()">Save Journey</button>
                <button class="btn" onclick="showIntro()">Replay Intro</button>
            </div>

            <div class="path-display hidden" id="pathDisplay">
                <strong>Your Path:</strong>
                <div id="pathText"></div>
            </div>
        </div>

        <div class="music-toggle" id="musicToggle" title="Toggle ambient sound">â™ª</div>
    </div>

    <script>
        // Narrator dialogue segments with positions and timing
        const narratorSegments = [
            {
                text: "Welcome back. You're still here, which means either you're desperate, masochistic, or human.",
                position: "position-bottom-center",
                duration: 4000
            },
            {
                text: "Regardlessâ€”congrats.",
                position: "position-top-right",
                duration: 2500
            },
            {
                text: "*adjusts broken halo and checks clipboard*",
                position: "position-middle-left",
                duration: 3000
            },
            {
                text: "So you're here because your brain decided to cosplay as a broken GPS again, huh? Maybe you're staring at a task like it personally wronged you in a past life.",
                position: "position-bottom-left",
                duration: 5500
            },
            {
                text: "Or perhaps you're one of those beautiful humans trying to understand why someone you care about seems to be locked in an eternal staring contest with their to-do list.",
                position: "position-top-center",
                duration: 6000
            },
            {
                text: "Either way, welcome to the 'Why You Can't Start' diagnostic flowchartâ€”",
                position: "position-middle-right",
                duration: 4000
            },
            {
                text: "Think of it as WebMD for your executive dysfunction, but with significantly more empathy and considerably fewer suggestions that you might be dying.",
                position: "position-bottom-center",
                duration: 6500
            },
            {
                text: "Okay. Pause. Did that last bit hit too close to home? That means it's working.",
                position: "position-top-right",
                duration: 4500
            },
            {
                text: "This little interactive adventure is going to walk you through the delightfully twisted maze of reasons why your brain might be staging a rebellion against productivity.",
                position: "position-middle-left",
                duration: 6000
            },
            {
                text: "We're talking about the REAL reasonsâ€”not the 'you're just lazy' nonsense that society loves to throw around like confetti at a particularly depressing party.",
                position: "position-bottom-left",
                duration: 6500
            },
            {
                text: "Whether you're here because you've never had words for what's happening in your head, or you're trying to understand someone else's beautiful, chaotic neural landscapeâ€”this is for you.",
                position: "position-top-center",
                duration: 7000
            },
            {
                text: "We're going meta, we're getting real, and yes, we're absolutely making jokes about the existential dread of late-stage capitalism.",
                position: "position-middle-right",
                duration: 5500
            },
            {
                text: "Consider this a little reward for all that heavy emotional work you've been doingâ€”reading, growing, trying to figure out this whole 'being human' thing.",
                position: "position-bottom-center",
                duration: 6500
            },
            {
                text: "I hope you're having fun so far, because we're about to dive into the wonderfully weird world of why our brains sometimes treat simple tasks like they're asking us to perform brain surgery while riding a unicycle.",
                position: "position-top-right",
                duration: 8000
            },
            {
                text: "I've seen the monsters in this chapter. I named a few of them. Keep going.",
                position: "position-middle-left",
                duration: 4000
            },
            {
                text: "You're not broken. You're just early in the story.",
                position: "position-bottom-left",
                duration: 3500
            },
            {
                text: "You do not have to become a productivity machine. You are already a goddamn miracle.",
                position: "position-top-center",
                duration: 4500
            },
            {
                text: "(Also? They get twitchy when people go off-script.)",
                position: "position-middle-right",
                duration: 3000
            },
            {
                text: "Ready to meet your mind's most creative excuses?",
                position: "position-bottom-center",
                duration: 4000
            }
        ];

        let currentSegmentIndex = 0;
        let currentPath = [];
        let activeNodes = new Set();
        let typewriterIndex = 0;
        let isTyping = false;
        let audioContext = null;
        let isMobile = window.innerWidth <= 768;

        const flowchartData = {
            start: {
                text: "Why can't I just do the thing?",
                x: isMobile ? 50 : 400,
                y: isMobile ? 50 : 50,
                choices: [
                    { text: "The thing haunts me", next: "haunted" },
                    { text: "The thing is too big", next: "tooBig" },
                    { text: "I am but a hollow shell", next: "hollow" },
                    { text: "My brain is a broken GPS", next: "brokenGPS" }
                ]
            },
            haunted: {
                text: "Are you emotionally haunted by this task?",
                x: isMobile ? 50 : 150,
                y: isMobile ? 200 : 200,
                choices: [
                    { text: "Yes, it whispers judgments", next: "trauma" },
                    { text: "No, just regular haunted", next: "perfectMood" }
                ]
            },
            tooBig: {
                text: "Is the task too big, like trying to eat a whole watermelon in one bite?",
                x: isMobile ? 50 : 650,
                y: isMobile ? 350 : 200,
                choices: [
                    { text: "Yes, I'm drowning in watermelon", next: "breakDown" },
                    { text: "No, it's bite-sized but cursed", next: "cursed" }
                ]
            },
            hollow: {
                text: "Have you eaten a food not classified as 'dust' today?",
                x: isMobile ? 50 : 150,
                y: isMobile ? 500 : 350,
                choices: [
                    { text: "Food is a social construct", next: "needFood" },
                    { text: "Yes, I'm adequately fueled", next: "rebellion" }
                ]
            },
            brokenGPS: {
                text: "Are you unsure where to start because you never learned how?",
                x: isMobile ? 50 : 650,
                y: isMobile ? 650 : 350,
                choices: [
                    { text: "My parents taught me shame, not systems", next: "noFramework" },
                    { text: "I know how, I just can't", next: "executive" }
                ]
            },
            trauma: {
                text: "Did your parents teach you productivity was moral worth?",
                x: isMobile ? 50 : 50,
                y: isMobile ? 800 : 350,
                choices: [
                    { text: "Yes, I am what I produce", next: "moralWorth" },
                    { text: "No, different flavor of trauma", next: "otherTrauma" }
                ]
            },
            perfectMood: {
                text: "Are you waiting to be in the perfect mood?",
                x: isMobile ? 50 : 250,
                y: isMobile ? 950 : 350,
                choices: [
                    { text: "Yes, waiting for the stars to align", next: "perfection" },
                    { text: "No, my mood is irrelevant", next: "blanket" }
                ]
            },
            breakDown: {
                text: "You need to break this watermelon of a task into tiny, manageable bites. That's not laziness, that's strategy. Your brain isn't brokenâ€”it just needs a different approach.",
                x: isMobile ? 50 : 550,
                y: isMobile ? 1100 : 350,
                terminal: true
            },
            cursed: {
                text: "Sometimes tasks feel cursed not because they're hard, but because they represent something we're avoiding. What is this task really about?",
                x: isMobile ? 50 : 750,
                y: isMobile ? 1250 : 350,
                terminal: true
            },
            needFood: {
                text: "Your brain runs on glucose, not willpower. Go eat something with actual nutrients. This isn't procrastinationâ€”it's basic maintenance.",
                x: isMobile ? 50 : 50,
                y: isMobile ? 1400 : 500,
                terminal: true
            },
            rebellion: {
                text: "Are you subconsciously staging a rebellion against late-stage capitalism?",
                x: isMobile ? 50 : 250,
                y: isMobile ? 1550 : 500,
                choices: [
                    { text: "Yes, down with productivity culture", next: "capitalism" },
                    { text: "No, this is personal resistance", next: "personalRebellion" }
                ]
            },
            noFramework: {
                text: "You're not lazyâ€”you're missing the instruction manual everyone else got. This is about learning systems, not fixing character flaws.",
                x: isMobile ? 50 : 550,
                y: isMobile ? 1700 : 500,
                terminal: true
            },
            executive: {
                text: "That's not a lack of discipline, that's executive dysfunction in cosplay. Your brain's task-starting engine needs a different kind of fuel.",
                x: isMobile ? 50 : 750,
                y: isMobile ? 1850 : 500,
                terminal: true
            },
            moralWorth: {
                text: "You are not what you produce. Your worth isn't measured in checkboxes. This paralysis? It's your psyche protecting you from impossible standards.",
                x: isMobile ? 50 : 50,
                y: isMobile ? 2000 : 650,
                terminal: true
            },
            otherTrauma: {
                text: "Trauma responses don't always look like crying. Sometimes they look like staring at a simple task for 3 hours. Be gentle with your nervous system.",
                x: isMobile ? 50 : 150,
                y: isMobile ? 2150 : 650,
                terminal: true
            },
            perfection: {
                text: "Perfect conditions are a myth. The 'right mood' is like waiting for a unicorn. Start ugly, start wrong, just start.",
                x: isMobile ? 50 : 250,
                y: isMobile ? 2300 : 650,
                terminal: true
            },
            blanket: {
                text: "Are you currently crying under a blanket?",
                x: isMobile ? 50 : 350,
                y: isMobile ? 2450 : 650,
                choices: [
                    { text: "Yes, blankets are my habitat", next: "blanketLife" },
                    { text: "No, but tempted", next: "overwhelming" }
                ]
            },
            capitalism: {
                text: "Valid rebellion. The system that demands constant productivity is the same one burning out our planet. Your resistance makes sense.",
                x: isMobile ? 50 : 150,
                y: isMobile ? 2600 : 800,
                terminal: true
            },
            personalRebellion: {
                text: "Sometimes not doing the thing IS the thing. Maybe you're protecting your energy for something that actually matters.",
                x: isMobile ? 50 : 250,
                y: isMobile ? 2750 : 800,
                terminal: true
            },
            blanketLife: {
                text: "Blankets are valid emotional infrastructure. Take your time. The task will wait. You're not brokenâ€”you're overwhelmed.",
                x: isMobile ? 50 : 350,
                y: isMobile ? 2900 : 800,
                terminal: true
            },
            overwhelming: {
                text: "Overwhelm is information. It's your system saying 'this is too much right now.' Listen to it. Scale down. Try one tiny thing.",
                x: isMobile ? 50 : 450,
                y: isMobile ? 3050 : 800,
                terminal: true
            }
        };

        // Create floating particles for entry screen
        function createEntryParticles() {
            const entryScreen = document.getElementById('entryScreen');
            
            for (let i = 0; i < (isMobile ? 8 : 15); i++) {
                const particle = document.createElement('div');
                particle.className = 'entry-particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 8 + 's';
                particle.style.animationDuration = (Math.random() * 4 + 6) + 's';
                entryScreen.appendChild(particle);
            }
        }

        // Create starfield
        function createStarfield(container) {
            const starCount = isMobile ? 50 : 100;
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.animationDelay = Math.random() * 3 + 's';
                star.style.animationDuration = (Math.random() * 2 + 2) + 's';
                container.appendChild(star);
            }
        }

        // Typewriter effect for individual segments
        function typeWriter(text, element, onComplete) {
            return new Promise((resolve) => {
                isTyping = true;
                element.innerHTML = '';
                
                const cursor = document.createElement('span');
                cursor.className = 'typing-cursor';
                element.appendChild(cursor);
                
                let i = 0;
                function type() {
                    if (i < text.length) {
                        cursor.remove();
                        
                        const char = text.charAt(i);
                        element.innerHTML += char;
                        
                        if (char !== ' ' && char !== '\n') {
                            playTypingSound();
                        }
                        
                        element.appendChild(cursor);
                        
                        let delay = isMobile ? 25 : 30; // Slightly faster on mobile
                        if (char === '.' || char === '!' || char === '?') {
                            delay = isMobile ? 300 : 400;
                        } else if (char === ',' || char === ';') {
                            delay = isMobile ? 150 : 200;
                        } else if (char === ' ') {
                            delay = isMobile ? 15 : 20;
                        }
                        
                        i++;
                        setTimeout(type, delay);
                    } else {
                        setTimeout(() => {
                            cursor.remove();
                            isTyping = false;
                            if (onComplete) onComplete();
                            resolve();
                        }, 500);
                    }
                }
                type();
            });
        }

        // Play narrator segments with movement
        async function playNarratorSegments() {
            const chatbox = document.getElementById('movingChatbox');
            const dialogue = document.getElementById('dialogue');
            
            for (let i = 0; i < narratorSegments.length; i++) {
                const segment = narratorSegments[i];
                
                // Fade out current chatbox
                if (i > 0) {
                    chatbox.classList.add('fade-out');
                    await new Promise(resolve => setTimeout(resolve, 800));
                }
                
                // Change position
                chatbox.className = `moving-chatbox ${segment.position}`;
                
                // Fade in at new position
                chatbox.classList.remove('fade-out');
                chatbox.classList.add('visible');
                
                // Type the text
                await typeWriter(segment.text, dialogue);
                
                // Shorter duration on mobile for better flow
                const duration = isMobile ? segment.duration * 0.8 : segment.duration;
                await new Promise(resolve => setTimeout(resolve, duration));
            }
            
            // Final fade out and transition to main app
            chatbox.classList.add('fade-out');
            
            // Wait a moment then transition to the diagnostic tool
            setTimeout(() => {
                enterMainApp();
            }, 1500);
        }

        // Typing sound effect
        function playTypingSound() {
            if (!audioContext) return;
            
            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                const filter = audioContext.createBiquadFilter();
                
                const notes = [523.25, 587.33, 659.25, 698.46, 783.99];
                const randomNote = notes[Math.floor(Math.random() * notes.length)];
                
                oscillator.frequency.setValueAtTime(randomNote, audioContext.currentTime);
                oscillator.type = 'triangle';
                
                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(2000, audioContext.currentTime);
                filter.Q.setValueAtTime(1, audioContext.currentTime);
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.03, audioContext.currentTime + 0.02); // Quieter on mobile
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.1);
                
                oscillator.frequency.exponentialRampToValueAtTime(randomNote * 0.95, audioContext.currentTime + 0.1);
                
                oscillator.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            } catch (e) {
                // Silently fail
            }
        }

        function startMainExperience() {
            const entryScreen = document.getElementById('entryScreen');
            const introScene = document.getElementById('introScene');
            
            // Initialize audio context
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            
            entryScreen.classList.add('fade-out');
            
            setTimeout(() => {
                introScene.classList.add('active');
                createStarfield(document.querySelector('#introScene .cosmic-bg'));
                
                setTimeout(() => {
                    playNarratorSegments();
                }, 1000);
            }, 1000);
            
            setTimeout(() => {
                entryScreen.style.display = 'none';
            }, 2000);
        }

        function enterMainApp() {
            const introScene = document.getElementById('introScene');
            const mainScene = document.getElementById('mainScene');
            
            introScene.classList.add('fade-out');
            
            setTimeout(() => {
                mainScene.classList.add('active');
                createStarfield(document.getElementById('mainCosmicBg'));
                initializeFlowchart();
            }, 1000);
            
            setTimeout(() => {
                introScene.style.display = 'none';
            }, 2000);
        }

        function showIntro() {
            const introScene = document.getElementById('introScene');
            const mainScene = document.getElementById('mainScene');
            
            mainScene.classList.remove('active');
            introScene.style.display = 'block';
            introScene.classList.remove('fade-out');
            introScene.classList.add('active');
            
            // Reset intro state
            currentSegmentIndex = 0;
            document.getElementById('movingChatbox').className = 'moving-chatbox position-bottom-center';
            
            setTimeout(() => {
                playNarratorSegments();
            }, 500);
        }

        function initializeFlowchart() {
            const flowchart = document.getElementById('flowchart');
            flowchart.innerHTML = '';
            currentPath = [];
            activeNodes.clear();
            updatePathDisplay();
            
            const startNode = createNode('start', flowchartData.start);
            flowchart.appendChild(startNode);
            activeNodes.add('start');
        }

        function createNode(id, data) {
            const node = document.createElement('div');
            node.className = 'node';
            if (data.terminal) {
                node.className += ' terminal-node';
            }
            node.id = id;
            
            if (!isMobile) {
                node.style.left = data.x + 'px';
                node.style.top = data.y + 'px';
            }

            const textDiv = document.createElement('div');
            textDiv.className = data.terminal ? 'terminal-text' : 'node-text';
            textDiv.textContent = data.text;
            node.appendChild(textDiv);

            if (!data.terminal && data.choices) {
                const choicesDiv = document.createElement('div');
                choicesDiv.className = 'choices';
                
                data.choices.forEach(choice => {
                    const btn = document.createElement('button');
                    btn.className = 'choice-btn';
                    btn.textContent = choice.text;
                    btn.onclick = () => selectChoice(id, choice);
                    choicesDiv.appendChild(btn);
                });

                node.appendChild(choicesDiv);
                
                node.onclick = () => {
                    if (!data.terminal) {
                        choicesDiv.classList.toggle('visible');
                        node.classList.toggle('active');
                    }
                };
            }

            node.classList.add('new');
            return node;
        }

        function selectChoice(fromId, choice) {
            currentPath.push(choice.text);
            updatePathDisplay();

            const fromNode = document.getElementById(fromId);
            const choicesDiv = fromNode.querySelector('.choices');
            if (choicesDiv) {
                choicesDiv.style.display = 'none';
            }

            const nextData = flowchartData[choice.next];
            if (nextData) {
                const flowchart = document.getElementById('flowchart');
                const nextNode = createNode(choice.next, nextData);
                flowchart.appendChild(nextNode);
                activeNodes.add(choice.next);

                if (!isMobile) {
                    createConnection(fromId, choice.next);
                }

                // Auto-scroll to new node on mobile
                if (isMobile) {
                    setTimeout(() => {
                        nextNode.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 300);
                }
            }
        }

        function createConnection(fromId, toId) {
            if (isMobile) return; // Skip connections on mobile
            
            const fromNode = document.getElementById(fromId);
            const toNode = document.getElementById(toId);
            
            if (!fromNode || !toNode) return;

            const fromX = fromNode.offsetLeft + fromNode.offsetWidth / 2;
            const fromY = fromNode.offsetTop + fromNode.offsetHeight;
            const toX = toNode.offsetLeft + toNode.offsetWidth / 2;
            const toY = toNode.offsetTop;

            const connection = document.createElement('div');
            connection.className = 'connection';
            
            const length = Math.sqrt(Math.pow(toX - fromX, 2) + Math.pow(toY - fromY, 2));
            const angle = Math.atan2(toY - fromY, toX - fromX) * 180 / Math.PI;

            connection.style.left = fromX + 'px';
            connection.style.top = fromY + 'px';
            connection.style.width = length + 'px';
            connection.style.transform = `rotate(${angle}deg)`;

            document.getElementById('flowchart').appendChild(connection);
        }

        function updatePathDisplay() {
            const pathDisplay = document.getElementById('pathDisplay');
            const pathText = document.getElementById('pathText');
            
            if (currentPath.length > 0) {
                pathDisplay.classList.remove('hidden');
                pathText.innerHTML = currentPath.map((step, index) => 
                    `${index + 1}. ${step}`
                ).join('<br>');
            } else {
                pathDisplay.classList.add('hidden');
            }
        }

        function startOver() {
            initializeFlowchart();
        }

        function downloadPath() {
            if (currentPath.length === 0) {
                alert("Take the journey first, then save your wisdom!");
                return;
            }

            const pathText = `My "Why You Can't Start" Journey:\n\n${currentPath.map((step, index) => 
                `${index + 1}. ${step}`
            ).join('\n')}\n\nGenerated by: Why You Can't Start Flowchart\nCreated by: Michaelrobins938\n${window.location.href}`;

            const blob = new Blob([pathText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'my-cant-start-journey.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function toggleMusic() {
            const musicToggle = document.getElementById('musicToggle');
            musicToggle.classList.toggle('playing');
        }

        // Handle orientation changes
        window.addEventListener('orientationchange', function() {
            setTimeout(() => {
                isMobile = window.innerWidth <= 768;
                // Refresh layout if needed
            }, 100);
        });

        // Initialize everything
        document.addEventListener('DOMContentLoaded', function() {
            isMobile = window.innerWidth <= 768;
            createEntryParticles();
            
            const entryScreen = document.getElementById('entryScreen');
            const diagnosticOrb = document.getElementById('diagnosticOrb');
            
            // Enhanced touch events for mobile
            entryScreen.addEventListener('click', startMainExperience);
            entryScreen.addEventListener('touchend', function(e) {
                e.preventDefault();
                startMainExperience();
            });
            
            diagnosticOrb.addEventListener('click', function(e) {
                e.stopPropagation();
                startMainExperience();
            });
            
            diagnosticOrb.addEventListener('touchend', function(e) {
                e.preventDefault();
                e.stopPropagation();
                startMainExperience();
            });
            
            document.getElementById('musicToggle').addEventListener('click', toggleMusic);
            document.getElementById('musicToggle').addEventListener('touchend', function(e) {
                e.preventDefault();
                toggleMusic();
            });
        });
    </script>
</body>
</html>
